<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="693px" preserveAspectRatio="none" style="width:1683px;height:693px;background:#FFFFFF;" version="1.1" viewBox="0 0 1683 693" width="1683px" zoomAndPan="magnify"><defs><filter height="300%" id="f1jcxjcozkfklz" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="798.0591" cy="124.6118" fill="#FEFECE" filter="url(#f1jcxjcozkfklz)" rx="78.5591" ry="18.1118" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="738.3328" y="128.1525">WiFi Check loop</text><ellipse cx="829.8073" cy="567.8615" fill="#FEFECE" filter="url(#f1jcxjcozkfklz)" rx="72.3073" ry="16.8615" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="777.3073" y="571.609">Start hotspot</text><ellipse cx="622.813" cy="124.2771" fill="#FEFECE" filter="url(#f1jcxjcozkfklz)" rx="60.813" ry="14.7771" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="585.813" y="128.0247">ESP Start</text><ellipse cx="798.1379" cy="323.0276" fill="#FEFECE" filter="url(#f1jcxjcozkfklz)" rx="83.1379" ry="19.0276" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="734.5914" y="326.0594">credentials exist?</text><ellipse cx="579.7754" cy="439.0551" fill="#FEFECE" filter="url(#f1jcxjcozkfklz)" rx="75.7754" ry="17.5551" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="522.7754" y="442.8026">connect to wifi</text><ellipse cx="484.0233" cy="567.9047" fill="#FEFECE" filter="url(#f1jcxjcozkfklz)" rx="67.5233" ry="15.9047" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="438.0233" y="571.6522">special case</text><ellipse cx="283.9563" cy="438.7913" fill="#FEFECE" filter="url(#f1jcxjcozkfklz)" rx="76.9563" ry="17.7913" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="225.5675" y="442.5101">stop the server</text><ellipse cx="167.1379" cy="323.0276" fill="#FEFECE" filter="url(#f1jcxjcozkfklz)" rx="83.1379" ry="19.0276" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="103.5914" y="326.0594">Stop the hotspot</text><ellipse cx="89.1379" cy="439.0276" fill="#FEFECE" filter="url(#f1jcxjcozkfklz)" rx="83.1379" ry="19.0276" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="25.5914" y="442.0594">start server &amp; WS</text><ellipse cx="1152.8142" cy="567.7628" fill="#FEFECE" filter="url(#f1jcxjcozkfklz)" rx="66.8142" ry="15.7628" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="1107.8142" y="571.5104">start server</text><ellipse cx="1152.9128" cy="438.9826" fill="#FEFECE" filter="url(#f1jcxjcozkfklz)" rx="87.9128" ry="19.9826" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137" x="1084.4128" y="441.8292">accept_credentials</text><ellipse cx="1320.7655" cy="568.0531" fill="#FEFECE" filter="url(#f1jcxjcozkfklz)" rx="65.7655" ry="15.5531" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="1277.2655" y="571.8007">[API] status</text><ellipse cx="1153.0612" cy="663.7122" fill="#FEFECE" filter="url(#f1jcxjcozkfklz)" rx="76.5612" ry="17.7122" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110" x="1095.0612" y="667.4598">[API] client_ack</text><path d="M916,310.5 L916,319 L881.246,323 L916,327 L916,335.6328 A0,0 0 0 0 916,335.6328 L1102,335.6328 A0,0 0 0 0 1102,335.6328 L1102,320.5 L1092,310.5 L916,310.5 A0,0 0 0 0 916,310.5 " fill="#FBFB77" filter="url(#f1jcxjcozkfklz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1092,310.5 L1092,320.5 L1102,320.5 L1092,310.5 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="922" y="327.5669">if checkCredentials is true</text><path d="M491.5,310.5 L491.5,335.6328 A0,0 0 0 0 491.5,335.6328 L576,335.6328 L580,421.345 L584,335.6328 L668.5,335.6328 A0,0 0 0 0 668.5,335.6328 L668.5,320.5 L658.5,310.5 L491.5,310.5 A0,0 0 0 0 491.5,310.5 " fill="#FBFB77" filter="url(#f1jcxjcozkfklz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M658.5,310.5 L658.5,320.5 L668.5,320.5 L658.5,310.5 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="497.5" y="327.5669">if connect_to_wifi is true</text><path d="M1276.5,426.5 L1276.5,435 L1241.14,439 L1276.5,443 L1276.5,451.6328 A0,0 0 0 0 1276.5,451.6328 L1465.5,451.6328 A0,0 0 0 0 1465.5,451.6328 L1465.5,436.5 L1455.5,426.5 L1276.5,426.5 A0,0 0 0 0 1276.5,426.5 " fill="#FBFB77" filter="url(#f1jcxjcozkfklz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1455.5,426.5 L1455.5,436.5 L1465.5,436.5 L1455.5,426.5 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="1282.5" y="443.5669">set connect_to_wifi is true</text><path d="M1422,555.5 L1422,564 L1387.06,568 L1422,572 L1422,580.6328 A0,0 0 0 0 1422,580.6328 L1674,580.6328 A0,0 0 0 0 1674,580.6328 L1674,565.5 L1664,555.5 L1422,555.5 A0,0 0 0 0 1422,555.5 " fill="#FBFB77" filter="url(#f1jcxjcozkfklz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1664,555.5 L1664,565.5 L1674,565.5 L1664,555.5 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="231" x="1428" y="572.5669">fetch "STATUS" variable and send it.</text><path d="M1265,651 L1265,659.5 L1229.78,663.5 L1265,667.5 L1265,676.1328 A0,0 0 0 0 1265,676.1328 L1457,676.1328 A0,0 0 0 0 1457,676.1328 L1457,661 L1447,651 L1265,651 A0,0 0 0 0 1265,651 " fill="#FBFB77" filter="url(#f1jcxjcozkfklz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1447,651 L1447,661 L1457,661 L1447,651 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="1271" y="668.0669">set CLOSE_SERVER to true</text><path d="M181,555.5 L181,580.6328 A0,0 0 0 0 181,580.6328 L381,580.6328 A0,0 0 0 0 381,580.6328 L381,565.5 L371,555.5 L285.274,555.5 L283.595,457.128 L277.274,555.5 L181,555.5 A0,0 0 0 0 181,555.5 " fill="#FBFB77" filter="url(#f1jcxjcozkfklz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M371,555.5 L371,565.5 L381,565.5 L371,555.5 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="187" y="572.5669">after CLOSE_SERVER is true</text><path d="M912,6 L912,242.9922 L1190,242.9922 L1190,16 L1180,6 L912,6 " fill="#FBFB77" filter="url(#f1jcxjcozkfklz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1180,6 L1180,16 L1190,16 L1180,6 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="918" y="23.0669">Some things loop has to take care of:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257" x="918" y="38.1997">- which API to register based on STATUS</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="918" y="53.3325">- valid STATUS: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="934" y="68.4653">NO_CREDS</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="934" y="83.5981">INVALID_PASS</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="934" y="98.731">NO_SSID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="934" y="113.8638">CONNECTING</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="934" y="128.9966">CONNECTED</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="934" y="144.1294">UNKNOWN_ERROR</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="926" y="159.2622">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="918" y="174.395">- other status variables: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="934" y="189.5278">CHECK_CREDENTIALS</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="934" y="204.6606">CONNECT_TO_WIFI</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="934" y="219.7935">CLOST_SERVER</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="926" y="234.9263">}</text><!--MD5=[0191433fe2be8f722fd5eb2e79f8eebf]
link ESP Start to wificheck--><path d="M684.182,124.5 C694.152,124.5 704.122,124.5 714.092,124.5 " fill="none" id="ESP Start-to-wificheck" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="719.305,124.5,710.305,120.5,714.305,124.5,710.305,128.5,719.305,124.5" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[a251461770b1016a4508f231243da7d5]
link wificheck to credentials exist?--><path d="M798,142.594 C798,177.892 798,258.868 798,298.828 " fill="none" id="wificheck-to-credentials exist?" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="798,303.954,802,294.954,798,298.954,794,294.954,798,303.954" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[5d433ac21485509f0ea592dd0564342a]
link credentials exist? to starthotspot--><path d="M800.405,342.264 C806.213,386.371 820.982,498.523 827.187,545.64 " fill="none" id="credentials exist?-to-starthotspot" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="827.865,550.79,830.6556,541.3448,827.2121,545.8328,822.7241,542.3893,827.865,550.79" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="816" y="443.5669">no</text><!--MD5=[285f78184c2d140d467ff1641b2f4014]
link credentials exist? to connect to wifi--><path d="M766.301,340.577 C725.625,361.847 655.36,398.592 613.727,420.363 " fill="none" id="credentials exist?-to-connect to wifi" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="609.293,422.681,619.1219,422.0541,613.7235,420.3636,615.414,414.9652,609.293,422.681" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="703" y="385.0669">yes</text><!--MD5=[c73d5e35231c00b88dd24ddb21e26aca]
link connect to wifi to special case--><path d="M542.766,454.312 C526.942,462.227 509.708,473.625 499,489 C487.246,505.876 484.096,529.562 483.515,546.396 " fill="none" id="connect to wifi-to-special case" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="483.407,551.822,487.5837,542.9026,483.5056,546.823,479.5852,542.7449,483.407,551.822" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="500" y="502.0669">SSID not available</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="69" x="525" y="517.1997">(error 201)</text><!--MD5=[86f3fd1272835c12caee0b2b68674399]
link connect to wifi to starthotspot--><path d="M593.343,456.437 C609.091,474.782 636.962,504.104 667,521 C697.895,538.378 735.838,549.589 767.34,556.589 " fill="none" id="connect to wifi-to-starthotspot" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="772.338,557.676,764.394,551.8543,767.4523,556.6131,762.6934,559.6714,772.338,557.676" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="674" y="502.0669">credentials invalid</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="668" y="517.1997">[error (15-24/202/)?]</text><!--MD5=[7ac84961c26b15b2bbe8d96a99a665a8]
link special case to starthotspot--><path d="M551.534,568 C609.111,568 691.892,568 752.227,568 " fill="none" id="special case-to-starthotspot" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="757.261,568,748.261,564,752.261,568,748.261,572,757.261,568" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="622" y="546.0669">not sure if</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="574" y="561.1997">hotspot should be started</text><!--MD5=[99007070c6f2aa5b947e5106c2c130cb]
reverse link stop the server to connect to wifi--><path d="M366.581,439 C409.584,439 461.811,439 503.836,439 " fill="none" id="stop the server-backto-connect to wifi" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="361.384,439,370.384,443,366.384,439,370.384,435,361.384,439" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="382.5" y="432.0669">on CONNECTED</text><!--MD5=[f9ee5e7d48e13e9bf3f5e1a86d7f6804]
reverse link Stop the hotspot to stop the server--><path d="M203.862,343.202 C216.828,351.04 230.917,360.888 242,372 C256.387,386.424 268.334,406.604 275.761,420.843 " fill="none" id="Stop the hotspot-backto-stop the server" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="199.514,340.622,205.2129,348.6546,203.814,343.1734,209.2952,341.7746,199.514,340.622" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[19a771b9d8b7dd48336143ceb3890a76]
link Stop the hotspot to start server & WS--><path d="M138.574,341.061 C127.266,349.148 115.056,359.735 107,372 C98.596,384.795 94.0917,401.436 91.6905,414.808 " fill="none" id="Stop the hotspot-to-start server &amp; WS" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="90.8413,419.943,96.256,411.7162,91.657,415.01,88.3632,410.411,90.8413,419.943" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="108" y="385.0669">register default APIs</text><!--MD5=[c2c4326f92b9a189a3f01a69cabaa7c2]
link starthotspot to start server--><path d="M902.89,568 C956.064,568 1027.8,568 1080.81,568 " fill="none" id="starthotspot-to-start server" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1085.88,568,1076.88,564,1080.88,568,1076.88,572,1085.88,568" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="920.75" y="561.0669">register credential APIs</text><!--MD5=[6f31ae3559dac5f154152abef833d9c3]
reverse link accept_credentials to start server--><path d="M1153,464.298 C1153,490.13 1153,530.179 1153,551.843 " fill="none" id="accept_credentials-backto-start server" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1153,459.013,1149,468.013,1153,464.013,1157,468.013,1153,459.013" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="1154" y="509.5669">wait for credentials</text><!--MD5=[63505aac74bc579133b1cb7acd8e42ef]
link start server to [API] status--><path d="M1220.27,568 C1230.09,568 1239.92,568 1249.75,568 " fill="none" id="start server-to-[API] status" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1254.89,568,1245.89,564,1249.89,568,1245.89,572,1254.89,568" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[646e348efb6b992cf4db0666b3bfacac]
link start server to [API] client_ack--><path d="M1153,584.0224 C1153,599.3669 1153,623.3459 1153,640.7615 " fill="none" id="start server-to-[API] client_ack" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1153,645.9389,1157,636.9389,1153,640.9389,1149,636.9389,1153,645.9389" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[3dd2dcaaa1b3bd74aca06761f3ff7855]
@startuml
usecase (WiFi Check loop) as wificheck
usecase (Start hotspot) as starthotspot
(ESP Start)->wificheck
wificheck- ->(credentials exist?)

' start chain reaction tests

(credentials exist?)->starthotspot : no
(credentials exist?)- ->(connect to wifi) : yes
(connect to wifi)- ->(special case) : SSID not available \n(error 201)
(connect to wifi)->starthotspot : credentials invalid \n[error (15-24/202/)?]
(special case).>starthotspot : not sure if\n hotspot should be started

' on wifi connect success
(connect to wifi)-left->(stop the server) : on CONNECTED
(Stop the hotspot)<- -(stop the server)
(Stop the hotspot)- ->(start server & WS) : register default APIs

' hotspot routine?
starthotspot->(start server) : register credential APIs
(accept_credentials)<- -(start server) : wait for credentials
' (accept_credentials)->(set recheck flag to true) : option 2 set a flag to true \nwhich the other loop will \nlook for constantly
(start server) -right-> ([API] status)
(start server) -down-> ([API] client_ack)

note right of (credentials exist?): if checkCredentials is true
note top of (connect to wifi): if connect_to_wifi is true
note right of (accept_credentials): set connect_to_wifi is true
note right of ([API] status): fetch "STATUS" variable and send it.
note right of ([API] client_ack): set CLOSE_SERVER to true
note bottom of (stop the server): after CLOSE_SERVER is true

note as n1
    Some things loop has to take care of:
    - which API to register based on STATUS
    - valid STATUS: {
        NO_CREDS
        INVALID_PASS
        NO_SSID
        CONNECTING
        CONNECTED
        UNKNOWN_ERROR
      }
    - other status variables: {
        CHECK_CREDENTIALS
        CONNECT_TO_WIFI
        CLOST_SERVER
      }
end note
' note "connect_to_wifi is true" as connect_note
' connect_note - (connect to wifi)
@enduml

@startuml
usecase (WiFi Check loop) as wificheck
usecase (Start hotspot) as starthotspot
(ESP Start)->wificheck
wificheck- ->(credentials exist?)


(credentials exist?)->starthotspot : no
(credentials exist?)- ->(connect to wifi) : yes
(connect to wifi)- ->(special case) : SSID not available \n(error 201)
(connect to wifi)->starthotspot : credentials invalid \n[error (15-24/202/)?]
(special case).>starthotspot : not sure if\n hotspot should be started

(connect to wifi)-left->(stop the server) : on CONNECTED
(Stop the hotspot)<- -(stop the server)
(Stop the hotspot)- ->(start server & WS) : register default APIs

starthotspot->(start server) : register credential APIs
(accept_credentials)<- -(start server) : wait for credentials
(start server) -right-> ([API] status)
(start server) -down-> ([API] client_ack)

note right of (credentials exist?): if checkCredentials is true
note top of (connect to wifi): if connect_to_wifi is true
note right of (accept_credentials): set connect_to_wifi is true
note right of ([API] status): fetch "STATUS" variable and send it.
note right of ([API] client_ack): set CLOSE_SERVER to true
note bottom of (stop the server): after CLOSE_SERVER is true

note as n1
    Some things loop has to take care of:
    - which API to register based on STATUS
    - valid STATUS: {
        NO_CREDS
        INVALID_PASS
        NO_SSID
        CONNECTING
        CONNECTED
        UNKNOWN_ERROR
      }
    - other status variables: {
        CHECK_CREDENTIALS
        CONNECT_TO_WIFI
        CLOST_SERVER
      }
end note
@enduml

PlantUML version 1.2021.13beta8(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>